{% extends "base.html" %}
{% load url from future %}
{% load dict_filters %}

{% block meta %}
<script type="text/javascript">
	$(document).ready(function() {
		$("#id_date").datepicker({
			minDate: 0,
			dateFormat: 'yy-mm-dd',
		});
		$("#id_time").timepicker({
			timeFormat: 'hh:mm:ss',
			stepHour: 1,
			stepMinute: 10,
		});
	});
	function editSession() {
		if ({{ data.session.countID }} == 0) { /* Only delete the session if no one is registered. */
			document.forms["editsession_form"].submit();
		}
		else {
			alert('A session cannot be edited if residents have already registered for it.')
		}
	}
	function deleteSession() {
		if ({{ data.session.countID }} == 0) { /* Only delete the session if no one is registered. */
			var response = confirm('Are you sure you want to delete this session?'); 
			if (response) {
				document.forms["deletesession_form"].submit();
			} else {
				return false;
			}
		}
		else {
			alert('A session cannot be deleted if residents have already registered for it.')
		}
	}
</script>
<style type="text/css">
	div.ui-datepicker, div.ui-timepicker{
 		font-size:12px;
	}
</style>
{% endblock %}

{% block subtitle %} | Session Details{% endblock %}

{% block content %}
	<div id="content">
	    <div id="mainLeftFull">
	        <h1>Session Details</h1>
	        <form method="post" action="{% url 'edit-session' data.session.id %}" id="editsession_form">
				<fieldset>
					<legend>Session Properties</legend>
					<p>
					{{ form.non_field_errors }}
					{% for field in form %}
					{{ field.errors }}
					{% endfor %}
					</p>
					{% for field in form %}
				        <p>
				            <label for="id_<field-name>">{{ field.label }}:</label>
				            {{ field }}
				        </p>
				    {% endfor %}
				</fieldset>				
				<p>
					<input type="hidden" name="method" value="edit"/>
					<input type="button" value="Update Properties" onclick="editSession();"/>
				</p>
				{% csrf_token %}
			</form>
			<form method="post" action="{% url 'edit-session' data.session.id %}" id="deletesession_form">		
				<p>
					<input type="hidden" name="method" value="delete"/>
					<input type="button" value="Delete Session" onclick="deleteSession();"/>
				</p>
				{% csrf_token %}
			</form>
			
			<h2>Current Zones</h2>
			<table border="1" class="table_directory">
	            <tbody>
	                <tr>
	                    <th scope="col" width="50%">Zone Number</th>
	                    <th scope="col" width="50%">Associated Locations</th>
	                </tr>
	                {% for i in data.zones|length|getrange %}
	                {% with data.zones|keyvalue:i as zone %}
	                {% if zone.names %}
	                <tr>
	                    <td>{{ zone.number }}</td>
	                    <td>
	                    	{% for name in zone.names %}
	                    		{{ name }}{% if not forloop.last %}, {% endif %}
	                    	{% endfor %}
	                    </td>
	                </tr>
	                {% endif %}
	                {% endwith %}
	                {% endfor %}
	            </tbody>
	        </table>
	        
	        <h2>Registered Residents</h2>
	        <table border="1" class="table_directory">
	            <tbody>
	                <tr>
	                    <th scope="col" width="100%">RMS ID</th>
	                </tr>
	                {% for rmsID in data.rmsIDList %}
	                <tr>
	                    <td>{{ rmsID }}</td>
	                </tr>
	                {% empty %}
	                <tr>
	                    <td>No students are currently registered with this session.</td>
	                </tr>
	                {% endfor %}
	            </tbody>
	        </table>
	    </div>        
	</div>
{% endblock %}
