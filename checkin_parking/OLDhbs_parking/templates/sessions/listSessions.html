{% extends "base.html" %}
{% load url from future %}
{% load dict_filters %}

{% block meta %}
<script type="text/javascript">
	function deleteSessionDate(table_id) {
		var disabledBoxes = $("#id_table_" + table_id + " input[type=checkbox]:disabled").length;
		if (disabledBoxes > 0) {
			alert('One or more sessions could not be deleted. A session cannot be deleted if residents have already registered for it.');
			return false;
		}
		
		var response = confirm('Are you sure you want to delete all sessions for this particular date?'); /* get confirmation */
		if (response) {
			var IDArr = $("#id_table_" + table_id + " input[type=checkbox]").map(function(i, el) { return $(el).attr("id"); }).get();
			var totalBoxes = $("#id_table_" + table_id + " input[type=checkbox]").length;
			Dajaxice.hbs_parking.main.request_deleteSessions(Dajax.process,{'sessionIDList':IDArr, 'totalBoxes':totalBoxes, 'table_id':table_id});
		} else {
			return false;
		}
	};
	function deleteCheckedSessions(table_id) {
		var response = confirm('Are you sure you want to delete selected sessions?');
		if (response) { /* get confirmation */
			var checkedIDArr = $("#id_table_" + table_id + " input[type=checkbox]:checked").map(function(i, el) { return $(el).attr("id"); }).get();
			var totalBoxes = $("#id_table_" + table_id + " input[type=checkbox]").length;
			Dajaxice.hbs_parking.main.request_deleteSessions(Dajax.process,{'sessionIDList':checkedIDArr, 'totalBoxes':totalBoxes, 'table_id':table_id});
		} else {
			return false;
		}
	};
	function deleteChecked_status(table_id) {
	    var checkedArr = $("#id_table_" + table_id + " input[type=checkbox]:checked");
	    var disabledArr = $("#id_table_" + table_id + " input[type=checkbox]:disabled");
	    if (checkedArr.length + disabledArr.length) {
	        $("#checkboxButton_" + table_id).attr("disabled", false);
	   	} else {
	       	$("#checkboxButton_" + table_id).attr("disabled", true);
	   	}
    };
</script>
{% endblock %}

{% block subtitle %} | Session List{% endblock %}

{% block content %}
	<div id="content">
	    <div id="mainLeftFull">
	        <h1>Session List</h1>
	        {% for i in data|length|getrange %}
	        {% with data|keyvalue:i as day %}
	        <div id="date_div_{{ i }}">
	        <h3>{{ day.0.date|date }}</h3>
	        <table border="1" class="table_directory" id="id_table_{{ i }}">
	            <tbody>
	                <tr>
	                    <th scope="col" width="15%">Time</th>
	                    <th scope="col" width="5%">Zone</th>
	                    <th scope="col" width="50%">Locations</th>
	                    <th scope="col" width="5%">Capacity</th>
	                    <th scope="col" width="5%">Remaining</th>
	                    <th scope="col" width="10%">Details</th>
	                    <th scope="col" width="10%">Delete</th>
	                </tr>
	                {% for j in day|length|getrange %}
	                {% with day|keyvalue:j as time %}
	                <tr id="session_{{ time.id }}_tr">
	                    <td>{{ time.time|time }}</td>
	                    <td>{{ time.zone }}</td>
	                    <td>
							{% with zones|keyvalue:time.zone as zone %}
	                    	{% for name in zone.names %}
			             		{{ name }}{% if not forloop.last %}, {% endif %}
			             	{% endfor %}
			             	{% endwith %}
			         	</td>
	                    <td>{{ time.maxID }}</td>
	                    <td>{{ time.maxID|subtract:time.countID }}</td>
						<td><a href="{% url 'edit-session' time.id %}"><img src="/static/images/details.png" /></a></td>
	                    <td><input type="checkbox" {% if time.countID > 0 %}disabled="true"{% endif %} id="session_{{ time.id }}" onclick="deleteChecked_status({{ i }});"/></td>
	                </tr>
	                {% endwith %}
	        		{% endfor %}
	            </tbody>
	        </table>
	        <form>
	        <p>
	        	<input type="button" class="button" value="Delete Date" onclick="deleteSessionDate({{ i }});"/>
	        	<input type="button" class="button" value="Delete Checked" onclick="deleteCheckedSessions({{ i }});" disabled="true" id="checkboxButton_{{ i }}"/>
			</p>
			</form>
			</div>
	        {% endwith %}
	        {% endfor %}
	    </div>        
	</div>
{% endblock %}
