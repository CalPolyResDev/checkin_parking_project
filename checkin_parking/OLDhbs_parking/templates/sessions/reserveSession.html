{% extends "base.html" %}
{% load url from future %}
{% load dict_filters %}

{% block meta %}
<script type="text/javascript">
	function reserveSession(sessionID) {
		Dajaxice.hbs_parking.main.request_reserveSession(Dajax.process,{'sessionID':sessionID});
	};
</script>
{% endblock %}

{% block subtitle %} | Reserve a Session{% endblock %}

{% block content %}
	<div id="content">
	    <div id="mainLeftFull">
	        <h1>Available Sessions</h1>
	        <p>To assist in unloading vehicles, short-term parking in the road areas nearest the apartments will be available on a pre-scheduled basis due to the limited number of parking spaces.  The following is a list of the different session times and dates available to you.</p>
	        <p>Sessions are filtered by the zone you are assigned. A zone is a parking area nearest a building or group of buildings. <br />
	       	<strong>Click on a session below to reserve it.</strong></p>
	        {% for i in data|length|getrange %}
	        {% with data|keyvalue:i as day %}
	        {% if day %}
	        <h3>{{ day.0.date|date }}</h3>
	        <table border="1" class="table_directory">
	            <tbody>
	                <tr>
	                    <th scope="col" width="15%">Time</th>
	                    <th scope="col" width="5%">Zone</th>
	                    <th scope="col" width="50%">Locations</th>
	                    <th scope="col" width="15%">Capacity</th>
	                    <th scope="col" width="15%">Remaining</th>
	                </tr>
	                {% for j in day|length|getrange %}
	                {% with day|keyvalue:j as time %}
	                <tr onclick='reserveSession({{ time.id }});'>
	                    <td>{{ time.time|time }}</td>
	                    <td>{{ time.zone }}</td>
	                    <td>
							{% with zones|keyvalue:time.zone as zone %}
	                    	{% for name in zone.names %}
			             		{{ name }}{% if not forloop.last %}, {% endif %}
			             	{% endfor %}
			             	{% endwith %}
			         	</td>
	                    <td>{{ time.maxID }}</td>
	                    <td>{{ time.maxID|subtract:time.countID }}</td>
	                </tr>
	                {% endwith %}
	        		{% endfor %}
	            </tbody>
	        </table>
	        {% endif %}
	        {% endwith %}
	        {% endfor %}
	    </div>        
	</div>
{% endblock %}
